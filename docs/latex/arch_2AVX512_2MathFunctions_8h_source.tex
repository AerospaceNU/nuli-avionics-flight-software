\doxysection{Math\+Functions.\+h}
\hypertarget{arch_2AVX512_2MathFunctions_8h_source}{}\label{arch_2AVX512_2MathFunctions_8h_source}\index{nuli-\/avionics-\/flight-\/software/platformio\_nuli\_avionics\_flight\_software/include/Eigen/src/Core/arch/AVX512/MathFunctions.h@{nuli-\/avionics-\/flight-\/software/platformio\_nuli\_avionics\_flight\_software/include/Eigen/src/Core/arch/AVX512/MathFunctions.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ This\ file\ is\ part\ of\ Eigen,\ a\ lightweight\ C++\ template\ library}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ for\ linear\ algebra.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ Copyright\ (C)\ 2016\ Pedro\ Gonnet\ (pedro.gonnet@gmail.com)}}
\DoxyCodeLine{00005\ \textcolor{comment}{//}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ This\ Source\ Code\ Form\ is\ subject\ to\ the\ terms\ of\ the\ Mozilla}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ Public\ License\ v.\ 2.0.\ If\ a\ copy\ of\ the\ MPL\ was\ not\ distributed}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ with\ this\ file,\ You\ can\ obtain\ one\ at\ http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#ifndef\ THIRD\_PARTY\_EIGEN3\_EIGEN\_SRC\_CORE\_ARCH\_AVX512\_MATHFUNCTIONS\_H\_}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#define\ THIRD\_PARTY\_EIGEN3\_EIGEN\_SRC\_CORE\_ARCH\_AVX512\_MATHFUNCTIONS\_H\_}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceEigen}{Eigen}}\ \{}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{namespace\ }internal\ \{}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#if\ EIGEN\_HAS\_AVX512\_MATH}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#define\ \_EIGEN\_DECLARE\_CONST\_Packet16f(NAME,\ X)\ \(\backslash\)}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\ \ const\ Packet16f\ p16f\_\#\#NAME\ =\ pset1<Packet16f>(X)}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#define\ \_EIGEN\_DECLARE\_CONST\_Packet16f\_FROM\_INT(NAME,\ X)\ \(\backslash\)}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\ \ const\ Packet16f\ p16f\_\#\#NAME\ =\ \ preinterpret<Packet16f,Packet16i>(pset1<Packet16i>(X))}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#define\ \_EIGEN\_DECLARE\_CONST\_Packet8d(NAME,\ X)\ \(\backslash\)}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\ \ const\ Packet8d\ p8d\_\#\#NAME\ =\ pset1<Packet8d>(X)}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#define\ \_EIGEN\_DECLARE\_CONST\_Packet8d\_FROM\_INT64(NAME,\ X)\ \(\backslash\)}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\ \ const\ Packet8d\ p8d\_\#\#NAME\ =\ \_mm512\_castsi512\_pd(\_mm512\_set1\_epi64(X))}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#define\ \_EIGEN\_DECLARE\_CONST\_Packet16bf(NAME,\ X)\ \(\backslash\)}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\ \ const\ Packet16bf\ p16bf\_\#\#NAME\ =\ pset1<Packet16bf>(X)}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#define\ \_EIGEN\_DECLARE\_CONST\_Packet16bf\_FROM\_INT(NAME,\ X)\ \(\backslash\)}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\ \ const\ Packet16bf\ p16bf\_\#\#NAME\ =\ \ preinterpret<Packet16bf,Packet16i>(pset1<Packet16i>(X))}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00038\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00039\ plog<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00040\ \ \ \textcolor{keywordflow}{return}\ plog\_float(\_x);}
\DoxyCodeLine{00041\ \}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00044\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet8d}
\DoxyCodeLine{00045\ plog<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ \_x)\ \{}
\DoxyCodeLine{00046\ \ \ \textcolor{keywordflow}{return}\ plog\_double(\_x);}
\DoxyCodeLine{00047\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ plog)}
\DoxyCodeLine{00050\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ plog)}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00053\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00054\ plog2<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordflow}{return}\ plog2\_float(\_x);}
\DoxyCodeLine{00056\ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00059\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet8d}
\DoxyCodeLine{00060\ plog2<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ \_x)\ \{}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{return}\ plog2\_double(\_x);}
\DoxyCodeLine{00062\ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ plog2)}
\DoxyCodeLine{00065\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ plog2)}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \textcolor{comment}{//\ Exponential\ function.\ Works\ by\ writing\ "{}x\ =\ m*log(2)\ +\ r"{}\ where}}
\DoxyCodeLine{00068\ \textcolor{comment}{//\ "{}m\ =\ floor(x/log(2)+1/2)"{}\ and\ "{}r"{}\ is\ the\ remainder.\ The\ result\ is\ then}}
\DoxyCodeLine{00069\ \textcolor{comment}{//\ "{}exp(x)\ =\ 2\string^m*exp(r)"{}\ where\ exp(r)\ is\ in\ the\ range\ [-\/1,1).}}
\DoxyCodeLine{00070\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00071\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00072\ pexp<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00073\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(1,\ 1.0f);}
\DoxyCodeLine{00074\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(\mbox{\hyperlink{structEigen_1_1internal_1_1unpacket__traits}{half}},\ 0.5f);}
\DoxyCodeLine{00075\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(127,\ 127.0f);}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(exp\_hi,\ 88.3762626647950f);}
\DoxyCodeLine{00078\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(exp\_lo,\ -\/88.3762626647949f);}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_LOG2EF,\ 1.44269504088896341f);}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_exp\_p0,\ 1.9875691500E-\/4f);}
\DoxyCodeLine{00083\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_exp\_p1,\ 1.3981999507E-\/3f);}
\DoxyCodeLine{00084\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_exp\_p2,\ 8.3334519073E-\/3f);}
\DoxyCodeLine{00085\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_exp\_p3,\ 4.1665795894E-\/2f);}
\DoxyCodeLine{00086\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_exp\_p4,\ 1.6666665459E-\/1f);}
\DoxyCodeLine{00087\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(cephes\_exp\_p5,\ 5.0000001201E-\/1f);}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \textcolor{comment}{//\ Clamp\ x.}}
\DoxyCodeLine{00090\ \ \ Packet16f\ x\ =\ pmax(pmin(\_x,\ p16f\_exp\_hi),\ p16f\_exp\_lo);}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \textcolor{comment}{//\ Express\ exp(x)\ as\ exp(m*ln(2)\ +\ r),\ start\ by\ extracting}}
\DoxyCodeLine{00093\ \ \ \textcolor{comment}{//\ m\ =\ floor(x/ln(2)\ +\ 0.5).}}
\DoxyCodeLine{00094\ \ \ Packet16f\ m\ =\ \_mm512\_floor\_ps(pmadd(x,\ p16f\_cephes\_LOG2EF,\ p16f\_half));}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \textcolor{comment}{//\ Get\ r\ =\ x\ -\/\ m*ln(2).\ Note\ that\ we\ can\ do\ this\ without\ losing\ more\ than\ one}}
\DoxyCodeLine{00097\ \ \ \textcolor{comment}{//\ ulp\ precision\ due\ to\ the\ FMA\ instruction.}}
\DoxyCodeLine{00098\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(nln2,\ -\/0.6931471805599453f);}
\DoxyCodeLine{00099\ \ \ Packet16f\ r\ =\ \_mm512\_fmadd\_ps(m,\ p16f\_nln2,\ x);}
\DoxyCodeLine{00100\ \ \ Packet16f\ r2\ =\ pmul(r,\ r);}
\DoxyCodeLine{00101\ \ \ Packet16f\ r3\ =\ pmul(r2,\ r);}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \textcolor{comment}{//\ Evaluate\ the\ polynomial\ approximant,improved\ by\ instruction-\/level\ parallelism.}}
\DoxyCodeLine{00104\ \ \ Packet16f\ y,\ y1,\ y2;}
\DoxyCodeLine{00105\ \ \ y\ \ =\ pmadd(p16f\_cephes\_exp\_p0,\ r,\ p16f\_cephes\_exp\_p1);}
\DoxyCodeLine{00106\ \ \ y1\ =\ pmadd(p16f\_cephes\_exp\_p3,\ r,\ p16f\_cephes\_exp\_p4);}
\DoxyCodeLine{00107\ \ \ y2\ =\ padd(r,\ p16f\_1);}
\DoxyCodeLine{00108\ \ \ y\ \ =\ pmadd(y,\ r,\ p16f\_cephes\_exp\_p2);}
\DoxyCodeLine{00109\ \ \ y1\ =\ pmadd(y1,\ r,\ p16f\_cephes\_exp\_p5);}
\DoxyCodeLine{00110\ \ \ y\ \ =\ pmadd(y,\ r3,\ y1);}
\DoxyCodeLine{00111\ \ \ y\ \ =\ pmadd(y,\ r2,\ y2);}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \textcolor{comment}{//\ Build\ emm0\ =\ 2\string^m.}}
\DoxyCodeLine{00114\ \ \ Packet16i\ emm0\ =\ \_mm512\_cvttps\_epi32(padd(m,\ p16f\_127));}
\DoxyCodeLine{00115\ \ \ emm0\ =\ \_mm512\_slli\_epi32(emm0,\ 23);}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \textcolor{comment}{//\ Return\ 2\string^m\ *\ exp(r).}}
\DoxyCodeLine{00118\ \ \ \textcolor{keywordflow}{return}\ pmax(pmul(y,\ \_mm512\_castsi512\_ps(emm0)),\ \_x);}
\DoxyCodeLine{00119\ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00122\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet8d}
\DoxyCodeLine{00123\ pexp<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ \_x)\ \{}
\DoxyCodeLine{00124\ \ \ \textcolor{keywordflow}{return}\ pexp\_double(\_x);}
\DoxyCodeLine{00125\ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ pexp)}
\DoxyCodeLine{00128\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ pexp)}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00131\ EIGEN\_STRONG\_INLINE\ Packet16h\ pfrexp(\textcolor{keyword}{const}\ Packet16h\&\ a,\ Packet16h\&\ exponent)\ \{}
\DoxyCodeLine{00132\ \ \ Packet16f\ fexponent;}
\DoxyCodeLine{00133\ \ \ \textcolor{keyword}{const}\ Packet16h\ out\ =\ float2half(pfrexp<Packet16f>(half2float(a),\ fexponent));}
\DoxyCodeLine{00134\ \ \ exponent\ =\ float2half(fexponent);}
\DoxyCodeLine{00135\ \ \ \textcolor{keywordflow}{return}\ out;}
\DoxyCodeLine{00136\ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00139\ EIGEN\_STRONG\_INLINE\ Packet16h\ pldexp(\textcolor{keyword}{const}\ Packet16h\&\ a,\ \textcolor{keyword}{const}\ Packet16h\&\ exponent)\ \{}
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{return}\ float2half(pldexp<Packet16f>(half2float(a),\ half2float(exponent)));}
\DoxyCodeLine{00141\ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00144\ EIGEN\_STRONG\_INLINE\ Packet16bf\ pfrexp(\textcolor{keyword}{const}\ Packet16bf\&\ a,\ Packet16bf\&\ exponent)\ \{}
\DoxyCodeLine{00145\ \ \ Packet16f\ fexponent;}
\DoxyCodeLine{00146\ \ \ \textcolor{keyword}{const}\ Packet16bf\ out\ =\ F32ToBf16(pfrexp<Packet16f>(Bf16ToF32(a),\ fexponent));}
\DoxyCodeLine{00147\ \ \ exponent\ =\ F32ToBf16(fexponent);}
\DoxyCodeLine{00148\ \ \ \textcolor{keywordflow}{return}\ out;}
\DoxyCodeLine{00149\ \}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00152\ EIGEN\_STRONG\_INLINE\ Packet16bf\ pldexp(\textcolor{keyword}{const}\ Packet16bf\&\ a,\ \textcolor{keyword}{const}\ Packet16bf\&\ exponent)\ \{}
\DoxyCodeLine{00153\ \ \ \textcolor{keywordflow}{return}\ F32ToBf16(pldexp<Packet16f>(Bf16ToF32(a),\ Bf16ToF32(exponent)));}
\DoxyCodeLine{00154\ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \textcolor{comment}{//\ Functions\ for\ sqrt.}}
\DoxyCodeLine{00157\ \textcolor{comment}{//\ The\ EIGEN\_FAST\_MATH\ version\ uses\ the\ \_mm\_rsqrt\_ps\ approximation\ and\ one\ step}}
\DoxyCodeLine{00158\ \textcolor{comment}{//\ of\ Newton's\ method,\ at\ a\ cost\ of\ 1-\/2\ bits\ of\ precision\ as\ opposed\ to\ the}}
\DoxyCodeLine{00159\ \textcolor{comment}{//\ exact\ solution.\ The\ main\ advantage\ of\ this\ approach\ is\ not\ just\ speed,\ but}}
\DoxyCodeLine{00160\ \textcolor{comment}{//\ also\ the\ fact\ that\ it\ can\ be\ inlined\ and\ pipelined\ with\ other\ computations,}}
\DoxyCodeLine{00161\ \textcolor{comment}{//\ further\ reducing\ its\ effective\ latency.}}
\DoxyCodeLine{00162\ \textcolor{preprocessor}{\#if\ EIGEN\_FAST\_MATH}}
\DoxyCodeLine{00163\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00164\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00165\ psqrt<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00166\ \ \ Packet16f\ neg\_half\ =\ pmul(\_x,\ pset1<Packet16f>(-\/.5f));}
\DoxyCodeLine{00167\ \ \ \_\_mmask16\ denormal\_mask\ =\ \_mm512\_kand(}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \_mm512\_cmp\_ps\_mask(\_x,\ pset1<Packet16f>((std::numeric\_limits<float>::min)()),}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_CMP\_LT\_OQ),}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \_mm512\_cmp\_ps\_mask(\_x,\ \_mm512\_setzero\_ps(),\ \_CMP\_GE\_OQ));}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ Packet16f\ x\ =\ \_mm512\_rsqrt14\_ps(\_x);}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \textcolor{comment}{//\ Do\ a\ single\ step\ of\ Newton's\ iteration.}}
\DoxyCodeLine{00175\ \ \ x\ =\ pmul(x,\ pmadd(neg\_half,\ pmul(x,\ x),\ pset1<Packet16f>(1.5f)));}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \textcolor{comment}{//\ Flush\ results\ for\ denormals\ to\ zero.}}
\DoxyCodeLine{00178\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_mask\_blend\_ps(denormal\_mask,\ pmul(\_x,x),\ \_mm512\_setzero\_ps());}
\DoxyCodeLine{00179\ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00182\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet8d}
\DoxyCodeLine{00183\ psqrt<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ \_x)\ \{}
\DoxyCodeLine{00184\ \ \ Packet8d\ neg\_half\ =\ pmul(\_x,\ pset1<Packet8d>(-\/.5));}
\DoxyCodeLine{00185\ \ \ \_\_mmask16\ denormal\_mask\ =\ \_mm512\_kand(}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \_mm512\_cmp\_pd\_mask(\_x,\ pset1<Packet8d>((std::numeric\_limits<double>::min)()),}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_CMP\_LT\_OQ),}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \_mm512\_cmp\_pd\_mask(\_x,\ \_mm512\_setzero\_pd(),\ \_CMP\_GE\_OQ));}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ Packet8d\ x\ =\ \_mm512\_rsqrt14\_pd(\_x);}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \textcolor{comment}{//\ Do\ a\ single\ step\ of\ Newton's\ iteration.}}
\DoxyCodeLine{00193\ \ \ x\ =\ pmul(x,\ pmadd(neg\_half,\ pmul(x,\ x),\ pset1<Packet8d>(1.5)));}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \textcolor{comment}{//\ Do\ a\ second\ step\ of\ Newton's\ iteration.}}
\DoxyCodeLine{00196\ \ \ x\ =\ pmul(x,\ pmadd(neg\_half,\ pmul(x,\ x),\ pset1<Packet8d>(1.5)));}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_mask\_blend\_pd(denormal\_mask,\ pmul(\_x,x),\ \_mm512\_setzero\_pd());}
\DoxyCodeLine{00199\ \}}
\DoxyCodeLine{00200\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00201\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00202\ EIGEN\_STRONG\_INLINE\ Packet16f\ psqrt<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ x)\ \{}
\DoxyCodeLine{00203\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_sqrt\_ps(x);}
\DoxyCodeLine{00204\ \}}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00207\ EIGEN\_STRONG\_INLINE\ Packet8d\ psqrt<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ x)\ \{}
\DoxyCodeLine{00208\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_sqrt\_pd(x);}
\DoxyCodeLine{00209\ \}}
\DoxyCodeLine{00210\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ psqrt)}
\DoxyCodeLine{00213\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ psqrt)}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \textcolor{comment}{//\ prsqrt\ for\ float.}}
\DoxyCodeLine{00216\ \textcolor{preprocessor}{\#if\ defined(EIGEN\_VECTORIZE\_AVX512ER)}}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00219\ EIGEN\_STRONG\_INLINE\ Packet16f\ prsqrt<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ x)\ \{}
\DoxyCodeLine{00220\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_rsqrt28\_ps(x);}
\DoxyCodeLine{00221\ \}}
\DoxyCodeLine{00222\ \textcolor{preprocessor}{\#elif\ EIGEN\_FAST\_MATH}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00225\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00226\ prsqrt<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00227\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f\_FROM\_INT(inf,\ 0x7f800000);}
\DoxyCodeLine{00228\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(one\_point\_five,\ 1.5f);}
\DoxyCodeLine{00229\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(minus\_half,\ -\/0.5f);}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ Packet16f\ neg\_half\ =\ pmul(\_x,\ p16f\_minus\_half);}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \textcolor{comment}{//\ Identity\ infinite,\ negative\ and\ denormal\ arguments.}}
\DoxyCodeLine{00234\ \ \ \_\_mmask16\ inf\_mask\ =\ \_mm512\_cmp\_ps\_mask(\_x,\ p16f\_inf,\ \_CMP\_EQ\_OQ);}
\DoxyCodeLine{00235\ \ \ \_\_mmask16\ not\_pos\_mask\ =\ \_mm512\_cmp\_ps\_mask(\_x,\ \_mm512\_setzero\_ps(),\ \_CMP\_LE\_OQ);}
\DoxyCodeLine{00236\ \ \ \_\_mmask16\ not\_finite\_pos\_mask\ =\ not\_pos\_mask\ |\ inf\_mask;}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \textcolor{comment}{//\ Compute\ an\ approximate\ result\ using\ the\ rsqrt\ intrinsic,\ forcing\ +inf}}
\DoxyCodeLine{00239\ \ \ \textcolor{comment}{//\ for\ denormals\ for\ consistency\ with\ AVX\ and\ SSE\ implementations.}}
\DoxyCodeLine{00240\ \ \ Packet16f\ y\_approx\ =\ \_mm512\_rsqrt14\_ps(\_x);}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \textcolor{comment}{//\ Do\ a\ single\ step\ of\ Newton-\/Raphson\ iteration\ to\ improve\ the\ approximation.}}
\DoxyCodeLine{00243\ \ \ \textcolor{comment}{//\ This\ uses\ the\ formula\ y\_\{n+1\}\ =\ y\_n\ *\ (1.5\ -\/\ y\_n\ *\ (0.5\ *\ x)\ *\ y\_n).}}
\DoxyCodeLine{00244\ \ \ \textcolor{comment}{//\ It\ is\ essential\ to\ evaluate\ the\ inner\ term\ like\ this\ because\ forming}}
\DoxyCodeLine{00245\ \ \ \textcolor{comment}{//\ y\_n\string^2\ may\ over-\/\ or\ underflow.}}
\DoxyCodeLine{00246\ \ \ Packet16f\ y\_newton\ =\ pmul(y\_approx,\ pmadd(y\_approx,\ pmul(neg\_half,\ y\_approx),\ p16f\_one\_point\_five));}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \textcolor{comment}{//\ Select\ the\ result\ of\ the\ Newton-\/Raphson\ step\ for\ positive\ finite\ arguments.}}
\DoxyCodeLine{00249\ \ \ \textcolor{comment}{//\ For\ other\ arguments,\ choose\ the\ output\ of\ the\ intrinsic.\ This\ will}}
\DoxyCodeLine{00250\ \ \ \textcolor{comment}{//\ return\ rsqrt(+inf)\ =\ 0,\ rsqrt(x)\ =\ NaN\ if\ x\ <\ 0,\ and\ rsqrt(0)\ =\ +inf.}}
\DoxyCodeLine{00251\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_mask\_blend\_ps(not\_finite\_pos\_mask,\ y\_newton,\ y\_approx);}
\DoxyCodeLine{00252\ \}}
\DoxyCodeLine{00253\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00256\ EIGEN\_STRONG\_INLINE\ Packet16f\ prsqrt<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ x)\ \{}
\DoxyCodeLine{00257\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet16f(one,\ 1.0f);}
\DoxyCodeLine{00258\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_div\_ps(p16f\_one,\ \_mm512\_sqrt\_ps(x));}
\DoxyCodeLine{00259\ \}}
\DoxyCodeLine{00260\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ prsqrt)}
\DoxyCodeLine{00263\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ prsqrt)}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \textcolor{comment}{//\ prsqrt\ for\ double.}}
\DoxyCodeLine{00266\ \textcolor{preprocessor}{\#if\ EIGEN\_FAST\_MATH}}
\DoxyCodeLine{00267\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00268\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet8d}
\DoxyCodeLine{00269\ prsqrt<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ \_x)\ \{}
\DoxyCodeLine{00270\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet8d(one\_point\_five,\ 1.5);}
\DoxyCodeLine{00271\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet8d(minus\_half,\ -\/0.5);}
\DoxyCodeLine{00272\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet8d\_FROM\_INT64(inf,\ 0x7ff0000000000000LL);}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ Packet8d\ neg\_half\ =\ pmul(\_x,\ p8d\_minus\_half);}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \textcolor{comment}{//\ Identity\ infinite,\ negative\ and\ denormal\ arguments.}}
\DoxyCodeLine{00277\ \ \ \_\_mmask8\ inf\_mask\ =\ \_mm512\_cmp\_pd\_mask(\_x,\ p8d\_inf,\ \_CMP\_EQ\_OQ);}
\DoxyCodeLine{00278\ \ \ \_\_mmask8\ not\_pos\_mask\ =\ \_mm512\_cmp\_pd\_mask(\_x,\ \_mm512\_setzero\_pd(),\ \_CMP\_LE\_OQ);}
\DoxyCodeLine{00279\ \ \ \_\_mmask8\ not\_finite\_pos\_mask\ =\ not\_pos\_mask\ |\ inf\_mask;}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \textcolor{comment}{//\ Compute\ an\ approximate\ result\ using\ the\ rsqrt\ intrinsic,\ forcing\ +inf}}
\DoxyCodeLine{00282\ \ \ \textcolor{comment}{//\ for\ denormals\ for\ consistency\ with\ AVX\ and\ SSE\ implementations.}}
\DoxyCodeLine{00283\ \textcolor{preprocessor}{\#if\ defined(EIGEN\_VECTORIZE\_AVX512ER)}}
\DoxyCodeLine{00284\ \ \ Packet8d\ y\_approx\ =\ \_mm512\_rsqrt28\_pd(\_x);}
\DoxyCodeLine{00285\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00286\ \ \ Packet8d\ y\_approx\ =\ \_mm512\_rsqrt14\_pd(\_x);}
\DoxyCodeLine{00287\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00288\ \ \ \textcolor{comment}{//\ Do\ one\ or\ two\ steps\ of\ Newton-\/Raphson's\ to\ improve\ the\ approximation,\ depending\ on\ the}}
\DoxyCodeLine{00289\ \ \ \textcolor{comment}{//\ starting\ accuracy\ (either\ 2\string^-\/14\ or\ 2\string^-\/28,\ depending\ on\ whether\ AVX512ER\ is\ available).}}
\DoxyCodeLine{00290\ \ \ \textcolor{comment}{//\ The\ Newton-\/Raphson\ algorithm\ has\ quadratic\ convergence\ and\ roughly\ doubles\ the\ number}}
\DoxyCodeLine{00291\ \ \ \textcolor{comment}{//\ of\ correct\ digits\ for\ each\ step.}}
\DoxyCodeLine{00292\ \ \ \textcolor{comment}{//\ This\ uses\ the\ formula\ y\_\{n+1\}\ =\ y\_n\ *\ (1.5\ -\/\ y\_n\ *\ (0.5\ *\ x)\ *\ y\_n).}}
\DoxyCodeLine{00293\ \ \ \textcolor{comment}{//\ It\ is\ essential\ to\ evaluate\ the\ inner\ term\ like\ this\ because\ forming}}
\DoxyCodeLine{00294\ \ \ \textcolor{comment}{//\ y\_n\string^2\ may\ over-\/\ or\ underflow.}}
\DoxyCodeLine{00295\ \ \ Packet8d\ y\_newton\ =\ pmul(y\_approx,\ pmadd(neg\_half,\ pmul(y\_approx,\ y\_approx),\ p8d\_one\_point\_five));}
\DoxyCodeLine{00296\ \textcolor{preprocessor}{\#if\ !defined(EIGEN\_VECTORIZE\_AVX512ER)}}
\DoxyCodeLine{00297\ \ \ y\_newton\ =\ pmul(y\_newton,\ pmadd(y\_newton,\ pmul(neg\_half,\ y\_newton),\ p8d\_one\_point\_five));}
\DoxyCodeLine{00298\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00299\ \ \ \textcolor{comment}{//\ Select\ the\ result\ of\ the\ Newton-\/Raphson\ step\ for\ positive\ finite\ arguments.}}
\DoxyCodeLine{00300\ \ \ \textcolor{comment}{//\ For\ other\ arguments,\ choose\ the\ output\ of\ the\ intrinsic.\ This\ will}}
\DoxyCodeLine{00301\ \ \ \textcolor{comment}{//\ return\ rsqrt(+inf)\ =\ 0,\ rsqrt(x)\ =\ NaN\ if\ x\ <\ 0,\ and\ rsqrt(0)\ =\ +inf.}}
\DoxyCodeLine{00302\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_mask\_blend\_pd(not\_finite\_pos\_mask,\ y\_newton,\ y\_approx);}
\DoxyCodeLine{00303\ \}}
\DoxyCodeLine{00304\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00305\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00306\ EIGEN\_STRONG\_INLINE\ Packet8d\ prsqrt<Packet8d>(\textcolor{keyword}{const}\ Packet8d\&\ x)\ \{}
\DoxyCodeLine{00307\ \ \ \_EIGEN\_DECLARE\_CONST\_Packet8d(one,\ 1.0f);}
\DoxyCodeLine{00308\ \ \ \textcolor{keywordflow}{return}\ \_mm512\_div\_pd(p8d\_one,\ \_mm512\_sqrt\_pd(x));}
\DoxyCodeLine{00309\ \}}
\DoxyCodeLine{00310\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \textcolor{keyword}{template}<>\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED}
\DoxyCodeLine{00313\ Packet16f\ plog1p<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00314\ \ \ \textcolor{keywordflow}{return}\ generic\_plog1p(\_x);}
\DoxyCodeLine{00315\ \}}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ plog1p)}
\DoxyCodeLine{00318\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ plog1p)}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \textcolor{keyword}{template}<>\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED}
\DoxyCodeLine{00321\ Packet16f\ pexpm1<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00322\ \ \ \textcolor{keywordflow}{return}\ generic\_expm1(\_x);}
\DoxyCodeLine{00323\ \}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ pexpm1)}
\DoxyCodeLine{00326\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ pexpm1)}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ EIGEN\_HAS\_AVX512\_MATH}}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00332\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00333\ psin<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00334\ \ \ \textcolor{keywordflow}{return}\ psin\_float(\_x);}
\DoxyCodeLine{00335\ \}}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00338\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00339\ pcos<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00340\ \ \ \textcolor{keywordflow}{return}\ pcos\_float(\_x);}
\DoxyCodeLine{00341\ \}}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00344\ EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS\ EIGEN\_UNUSED\ Packet16f}
\DoxyCodeLine{00345\ ptanh<Packet16f>(\textcolor{keyword}{const}\ Packet16f\&\ \_x)\ \{}
\DoxyCodeLine{00346\ \ \ \textcolor{keywordflow}{return}\ internal::generic\_fast\_tanh\_float(\_x);}
\DoxyCodeLine{00347\ \}}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ psin)}
\DoxyCodeLine{00350\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ pcos)}
\DoxyCodeLine{00351\ F16\_PACKET\_FUNCTION(Packet16f,\ Packet16h,\ ptanh)}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ psin)}
\DoxyCodeLine{00354\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ pcos)}
\DoxyCodeLine{00355\ BF16\_PACKET\_FUNCTION(Packet16f,\ Packet16bf,\ ptanh)}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \}\ \ \textcolor{comment}{//\ end\ namespace\ internal}}
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00359\ \}\ \ \textcolor{comment}{//\ end\ namespace\ Eigen}}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ THIRD\_PARTY\_EIGEN3\_EIGEN\_SRC\_CORE\_ARCH\_AVX512\_MATHFUNCTIONS\_H\_}}

\end{DoxyCode}
