\doxysection{Basic\+Logger.\+h}
\hypertarget{BasicLogger_8h_source}{}\label{BasicLogger_8h_source}\index{nuli-\/avionics-\/flight-\/software/platformio\_nuli\_avionics\_flight\_software/src/core/BasicLogger.h@{nuli-\/avionics-\/flight-\/software/platformio\_nuli\_avionics\_flight\_software/src/core/BasicLogger.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ BASICLOGGER\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ BASICLOGGER\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{Avionics_8h}{Avionics.h}}"{}}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}HardwareAbstraction.h"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}configuration/Configuration.h"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}cli/Parser.h"{}}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ LogDataStruct>}
\DoxyCodeLine{00010\ \textcolor{keyword}{class\ }BasicLogger\ \{}
\DoxyCodeLine{00011\ \ \ \ \ \textcolor{comment}{//\ clang-\/format\ off}}
\DoxyCodeLine{00012\ \ \ \ \ \textcolor{keyword}{struct\ }InternalStruct\_s\ \{}
\DoxyCodeLine{00013\ \ \ \ \ \ \ \ \ uint8\_t\ \textcolor{keywordtype}{id}\ =\ 0;}
\DoxyCodeLine{00014\ \ \ \ \ \ \ \ \ LogDataStruct\ data;}
\DoxyCodeLine{00015\ \ \ \ \ \}\ remove\_struct\_padding;}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{comment}{//\ clang-\/format\ on}}
\DoxyCodeLine{00017\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00018\ \ \ \ \ BasicLogger()\ :\ m\_logFlag(\textcolor{stringliteral}{"{}-\/-\/log"{}},\ \textcolor{stringliteral}{"{}Send\ start"{}},\ \textcolor{keyword}{true},\ 255,\ [\textcolor{keyword}{this}]()\ \{\ this-\/>logCallback();\ \}),}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_startFlag(\textcolor{stringliteral}{"{}-\/b"{}},\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{keyword}{false},\ 255,\ []()\ \{\}),}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_endFlag(\textcolor{stringliteral}{"{}-\/e"{}},\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{keyword}{false},\ 255,\ []()\ \{\}),}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_offloadBinaryFlag(\textcolor{stringliteral}{"{}-\/b"{}},\ \textcolor{stringliteral}{"{}binary"{}},\ \textcolor{keyword}{false},\ 255,\ []()\ \{\}),}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_eraseFlag(\textcolor{stringliteral}{"{}-\/-\/erase"{}},\ \textcolor{stringliteral}{"{}Send\ start"{}},\ \textcolor{keyword}{true},\ 255,\ [\textcolor{keyword}{this}]()\ \{\ this-\/>eraseCallback();\ \}),}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_offloadFlag(\textcolor{stringliteral}{"{}-\/-\/offload"{}},\ \textcolor{stringliteral}{"{}Send\ start"{}},\ \textcolor{keyword}{true},\ 255,\ [\textcolor{keyword}{this}]()\ \{\ this-\/>offloadCallback();\ \}),}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_streamFlag(\textcolor{stringliteral}{"{}-\/-\/streamLog"{}},\ \textcolor{stringliteral}{"{}Send\ start"{}},\ \textcolor{keyword}{true},\ 255,\ [\textcolor{keyword}{this}]()\ \{\ this-\/>streamCallback();\ \})\ \{\}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordtype}{void}\ setup(\mbox{\hyperlink{classHardwareAbstraction}{HardwareAbstraction}}*\ hardware,\ \mbox{\hyperlink{classParser}{Parser}}*\ parser,\ \textcolor{keyword}{const}\ uint8\_t\ flashID,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ header,\ \textcolor{keywordtype}{void}\ (*printFunction)(\textcolor{keyword}{const}\ LogDataStruct\&,\ \mbox{\hyperlink{classDebugStream}{DebugStream}}*))\ \{}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ m\_hardware\ =\ hardware;}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ m\_debug\ =\ m\_hardware-\/>getDebugStream();}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ m\_flash\ =\ m\_hardware-\/>getFlashMemory(flashID);}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ m\_logWriteIndex\ =\ 0;}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ m\_headerStr\ =\ header;}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ m\_printFunction\ =\ printFunction;}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ m\_loopTime\ =\ hardware-\/>getTargetLoopTimeMs();}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Setup\ CLI\ interface}}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ m\_offloadBinaryFlag.setDependency(\&m\_offloadBinaryFlag);}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ parser-\/>\mbox{\hyperlink{classParser_abe4ff3e3ab2bbe35be3053c3510d37f2}{addFlagGroup}}(m\_eraseGroup);}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ parser-\/>\mbox{\hyperlink{classParser_abe4ff3e3ab2bbe35be3053c3510d37f2}{addFlagGroup}}(m\_offloadGroup);}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ parser-\/>\mbox{\hyperlink{classParser_abe4ff3e3ab2bbe35be3053c3510d37f2}{addFlagGroup}}(m\_logGroup);}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ parser-\/>\mbox{\hyperlink{classParser_abe4ff3e3ab2bbe35be3053c3510d37f2}{addFlagGroup}}(m\_streamGroup);}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ numEntries\ =\ m\_flash-\/>getMemorySizeBytes()\ /\ \textcolor{keyword}{sizeof}(InternalStruct\_s);}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ uint32\_t\ left\ =\ 0;}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ uint32\_t\ right\ =\ numEntries;\ \textcolor{comment}{//\ exclusive\ upper\ bound}}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ uint32\_t\ firstEmpty\ =\ numEntries;\ \textcolor{comment}{//\ default\ if\ nothing\ is\ 0xFF}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (left\ <\ right)\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ mid\ =\ left\ +\ (right\ -\/\ left)\ /\ 2;}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ id;}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ offload(mid,\ \textcolor{keywordtype}{id});}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{id}\ ==\ 0xFF)\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ firstEmpty\ =\ mid;\ \textcolor{comment}{//\ possible\ candidate}}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ right\ =\ mid;\ \textcolor{comment}{//\ search\ left\ half}}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ left\ =\ mid\ +\ 1;\ \textcolor{comment}{//\ search\ right\ half}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ firstEmpty\ is\ now\ the\ first\ index\ where\ id\ ==\ 0xFF}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ m\_logWriteIndex\ =\ firstEmpty;}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}Logging\ setup,\ starting\ at\ entry:\ \%d,\ index:\ \%d"{}},\ getEntryNumber(),\ (m\_logWriteIndex\ *\ \textcolor{keyword}{sizeof}(InternalStruct\_s)));}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}Maximum\ log\ length\ (s):\ \%d,\ Remaining\ log\ length\ (s):\ \%d"{}},\ getMaxLogLengthSeconds(),\ getRemainingLogLengthSeconds());}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ logMessage(\textcolor{stringliteral}{"{}Logger\ setup"{}});}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordtype}{void}\ log(\textcolor{keyword}{const}\ LogDataStruct\&\ logDataStruct)\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ m\_currentTick++;}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_enableLogging\ ||\ m\_currentTick\ >=\ m\_ticksPerLog)\ \{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_currentTick\ >=\ m\_ticksPerLog)\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_currentTick\ =\ 0;}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ m\_dataStruct.id\ =\ 0x01;}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ m\_dataStruct.data\ =\ logDataStruct;}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ m\_flash-\/>write(m\_logWriteIndex\ *\ \textcolor{keyword}{sizeof}(InternalStruct\_s),\ m\_dataStructStart,\ \textcolor{keyword}{sizeof}(InternalStruct\_s),\ \textcolor{keyword}{true});}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ m\_logWriteIndex++;}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_enableStreaming)\ \{}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ m\_printFunction(logDataStruct,\ m\_debug);}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00083\ \ \ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordtype}{void}\ logMessage(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ str)\ \{}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ m\_dataStruct.id\ =\ 0x03;}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ memcpy(\&m\_dataStruct.data,\ str,\ std::min(\textcolor{keyword}{sizeof}(LogDataStruct),\ strlen(str)\ +\ 1));}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ ((\textcolor{keywordtype}{char}*)(\&m\_dataStruct.data))[\textcolor{keyword}{sizeof}(LogDataStruct)\ -\/\ 1]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};\ \textcolor{comment}{//\ Ensure\ null\ termination}}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ m\_flash-\/>write(m\_logWriteIndex\ *\ \textcolor{keyword}{sizeof}(InternalStruct\_s),\ m\_dataStructStart,\ \textcolor{keyword}{sizeof}(InternalStruct\_s),\ \textcolor{keyword}{true});}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ m\_logWriteIndex++;}
\DoxyCodeLine{00091\ \ \ \ \ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordtype}{void}\ newFlight()\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ m\_dataStruct.id\ =\ 0x02;}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ m\_flash-\/>write(m\_logWriteIndex\ *\ \textcolor{keyword}{sizeof}(InternalStruct\_s),\ m\_dataStructStart,\ \textcolor{keyword}{sizeof}(InternalStruct\_s),\ \textcolor{keyword}{true});}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ m\_logWriteIndex++;}
\DoxyCodeLine{00097\ \ \ \ \ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordtype}{void}\ erase()\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ m\_flash-\/>eraseAll(\textcolor{keyword}{true});}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ m\_logWriteIndex\ =\ 0;}
\DoxyCodeLine{00102\ \ \ \ \ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ LogDataStruct\ offload(\textcolor{keyword}{const}\ uint32\_t\ index,\ uint8\_t\&\ \textcolor{keywordtype}{id})\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ m\_flash-\/>read(index\ *\ \textcolor{keyword}{sizeof}(InternalStruct\_s),\ m\_dataStructStart,\ \textcolor{keyword}{sizeof}(InternalStruct\_s));}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{id}\ =\ m\_dataStruct.id;}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_dataStruct.data;}
\DoxyCodeLine{00108\ \ \ \ \ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ uint32\_t\ getEntryNumber()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_logWriteIndex;}
\DoxyCodeLine{00112\ \ \ \ \ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ uint32\_t\ getMaxLogLengthSeconds()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Total\ entries\ the\ flash\ can\ hold}}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ totalEntries\ =\ m\_flash-\/>getMemorySizeBytes()\ /\ \textcolor{keyword}{sizeof}(InternalStruct\_s);}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Convert\ loop\ time\ from\ ms\ to\ seconds}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ loopTimeSec\ =\ m\_hardware-\/>getTargetLoopTimeMs()\ /\ 1000.0f;}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Maximum\ duration\ =\ total\ entries\ *\ loop\ time}}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}uint32\_t\textcolor{keyword}{>}(totalEntries\ *\ loopTimeSec);}
\DoxyCodeLine{00123\ \ \ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ uint32\_t\ getRemainingLogLengthSeconds()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Total\ entries\ the\ flash\ can\ hold}}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ totalEntries\ =\ m\_flash-\/>getMemorySizeBytes()\ /\ \textcolor{keyword}{sizeof}(InternalStruct\_s);}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remaining\ entries}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ remainingEntries\ =\ totalEntries\ -\/\ m\_logWriteIndex;}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Convert\ loop\ time\ from\ ms\ to\ seconds}}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ loopTimeSec\ =\ m\_hardware-\/>getTargetLoopTimeMs()\ /\ 1000.0f;}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remaining\ duration\ =\ remaining\ entries\ *\ loop\ time}}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}uint32\_t\textcolor{keyword}{>}(remainingEntries\ *\ loopTimeSec);}
\DoxyCodeLine{00137\ \ \ \ \ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordtype}{void}\ offloadCallback()\ \{}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ uint32\_t\ failCount\ =\ 0;}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}Starting\ Offload"{}});}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ m\_debug-\/>data(m\_headerStr);}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ \textcolor{keyword}{true};\ i++)\ \{}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ id;}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LogDataStruct\ logData\ =\ offload(i,\ \textcolor{keywordtype}{id});}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{id}\ ==\ 0xFF)\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ failCount++;}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (failCount\ >=\ 4)\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{id}\ ==\ 0x01)\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_printFunction(logData,\ m\_debug);}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{id}\ ==\ 0x02)\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_debug-\/>data(\textcolor{stringliteral}{"{}New\ flight"{}});}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{id}\ ==\ 0x03)\ \{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}*\ str\ =\ (\textcolor{keywordtype}{char}*)\&logData;}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ str[\textcolor{keyword}{sizeof}(LogDataStruct)\ -\/\ 1]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_debug-\/>data(\textcolor{stringliteral}{"{}\%s"{}},\ str);}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}Ending\ Offload"{}});}
\DoxyCodeLine{00162\ \ \ \ \ \}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordtype}{void}\ eraseCallback()\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}Erasing\ all"{}});}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ erase();}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}Done"{}});}
\DoxyCodeLine{00168\ \ \ \ \ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordtype}{void}\ enableStreaming()\ \{}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ m\_enableStreaming\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00172\ \ \ \ \ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordtype}{void}\ disableStreaming()\ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ m\_enableStreaming\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00176\ \ \ \ \ \}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{keywordtype}{void}\ logCallback()\ \{}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}Entries\ in\ log:\ \%d"{}},\ getEntryNumber());}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}Remaining\ log\ length:\ \%d\ seconds"{}},\ getRemainingLogLengthSeconds());}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_startFlag.isSet()\ \&\&\ !m\_endFlag.isSet())\ \{}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ m\_enableLogging\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}Logging\ enabled"{}});}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (m\_endFlag.isSet()\ \&\&\ !m\_startFlag.isSet())\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ m\_enableLogging\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}Logging\ disabled"{}});}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ m\_debug-\/>message(m\_enableLogging\ ?\ \textcolor{stringliteral}{"{}Logging\ is\ enabled"{}}\ :\ \textcolor{stringliteral}{"{}Logging\ is\ disabled"{}});}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00190\ \ \ \ \ \}}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordtype}{void}\ streamCallback()\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_startFlag.isSet()\ \&\&\ !m\_endFlag.isSet())\ \{}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ m\_enableStreaming\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}Streaming\ enabled"{}});}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (m\_endFlag.isSet()\ \&\&\ !m\_startFlag.isSet())\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ m\_enableStreaming\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}Streaming\ disabled"{}});}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ m\_debug-\/>message(m\_enableStreaming\ ?\ \textcolor{stringliteral}{"{}Streaming\ is\ enabled"{}}\ :\ \textcolor{stringliteral}{"{}Streaming\ is\ disabled"{}});}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00202\ \ \ \ \ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordtype}{void}\ enableContinuousLogging()\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ m\_enableLogging\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00206\ \ \ \ \ \}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keywordtype}{void}\ setLogDelay(\textcolor{keyword}{const}\ uint32\_t\ delay)\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ m\_ticksPerLog\ =\ delay\ /\ m\_loopTime;}
\DoxyCodeLine{00210\ \ \ \ \ \}}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordtype}{void}\ disableContinuousLogging()\ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ m\_enableLogging\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00214\ \ \ \ \ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordtype}{bool}\ isLoggingEnabled()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_enableLogging;}
\DoxyCodeLine{00218\ \ \ \ \ \}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_enableLogging\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_enableStreaming\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \ \ \mbox{\hyperlink{classSimpleFlag}{SimpleFlag}}\ m\_logFlag;}
\DoxyCodeLine{00225\ \ \ \ \ \mbox{\hyperlink{classSimpleFlag}{SimpleFlag}}\ m\_startFlag;}
\DoxyCodeLine{00226\ \ \ \ \ \mbox{\hyperlink{classSimpleFlag}{SimpleFlag}}\ m\_endFlag;}
\DoxyCodeLine{00227\ \ \ \ \ \mbox{\hyperlink{classSimpleFlag}{SimpleFlag}}\ m\_offloadBinaryFlag;}
\DoxyCodeLine{00228\ \ \ \ \ \mbox{\hyperlink{classSimpleFlag}{SimpleFlag}}\ m\_eraseFlag;}
\DoxyCodeLine{00229\ \ \ \ \ \mbox{\hyperlink{classSimpleFlag}{SimpleFlag}}\ m\_offloadFlag;}
\DoxyCodeLine{00230\ \ \ \ \ \mbox{\hyperlink{classSimpleFlag}{SimpleFlag}}\ m\_streamFlag;}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \ \ \mbox{\hyperlink{classBaseFlag}{BaseFlag}}*\ m\_logGroup[3]\ =\ \{\&m\_logFlag,\ \&m\_startFlag,\ \&m\_endFlag\};}
\DoxyCodeLine{00233\ \ \ \ \ \mbox{\hyperlink{classBaseFlag}{BaseFlag}}*\ m\_eraseGroup[1]\ =\ \{\&m\_eraseFlag\};}
\DoxyCodeLine{00234\ \ \ \ \ \mbox{\hyperlink{classBaseFlag}{BaseFlag}}*\ m\_offloadGroup[2]\ =\ \{\&m\_offloadFlag,\ \&m\_offloadBinaryFlag\};}
\DoxyCodeLine{00235\ \ \ \ \ \mbox{\hyperlink{classBaseFlag}{BaseFlag}}*\ m\_streamGroup[3]\ =\ \{\&m\_streamFlag,\ \&m\_startFlag,\ \&m\_endFlag\};}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \ \ \mbox{\hyperlink{classHardwareAbstraction}{HardwareAbstraction}}*\ m\_hardware\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00238\ \ \ \ \ \mbox{\hyperlink{classDebugStream}{DebugStream}}*\ m\_debug\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00239\ \ \ \ \ \mbox{\hyperlink{classFlashMemory}{FlashMemory}}*\ m\_flash\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00240\ \ \ \ \ uint32\_t\ m\_logWriteIndex\ =\ 0;}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ InternalStruct\_s\ m\_dataStruct\{\};}
\DoxyCodeLine{00243\ \ \ \ \ uint8\_t*\ m\_dataStructStart\ =\ (uint8\_t*)\&m\_dataStruct;}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ uint32\_t\ m\_loopTime\ =\ 0;}
\DoxyCodeLine{00246\ \ \ \ \ uint32\_t\ m\_ticksPerLog\ =\ 1;}
\DoxyCodeLine{00247\ \ \ \ \ uint32\_t\ m\_currentTick\ =\ 0;}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ m\_headerStr\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00250\ \ \ \ \ void\ (*m\_printFunction)(\textcolor{keyword}{const}\ LogDataStruct\&,\ \mbox{\hyperlink{classDebugStream}{DebugStream}}*)\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00251\ \};}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//BASICLOGGER\_H}}

\end{DoxyCode}
