\doxysection{Configuration\+Cli\+Binding.\+h}
\hypertarget{ConfigurationCliBinding_8h_source}{}\label{ConfigurationCliBinding_8h_source}\index{nuli-\/avionics-\/flight-\/software/platformio\_nuli\_avionics\_flight\_software/src/core/configuration/ConfigurationCliBinding.h@{nuli-\/avionics-\/flight-\/software/platformio\_nuli\_avionics\_flight\_software/src/core/configuration/ConfigurationCliBinding.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include\ <type\_traits>}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{Avionics_8h}{Avionics.h}}"{}}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}core/cli/Parser.h"{}}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}core/cli/SimpleFlag.h"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}core/cli/ArgumentFlag.h"{}}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00009\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structis__configuration__string}{is\_configuration\_string}}\ :\ std::false\_type\ \{\};}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{unsigned}\ N>}
\DoxyCodeLine{00012\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structis__configuration__string}{is\_configuration\_string}}<\mbox{\hyperlink{structConfigurationString}{ConfigurationString}}<N>>\ :\ std::true\_type\ \{\};}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00015\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structconfig__flag__type}{config\_flag\_type}}\ \{}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{keyword}{using\ }type\ =\ T;}
\DoxyCodeLine{00017\ \};}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{unsigned}\ N>}
\DoxyCodeLine{00020\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structconfig__flag__type}{config\_flag\_type}}<\mbox{\hyperlink{structConfigurationString}{ConfigurationString}}<N>>\ \{}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keyword}{using\ }type\ =\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*;}
\DoxyCodeLine{00022\ \};}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{unsigned}\ ConfigurationID>}
\DoxyCodeLine{00025\ \textcolor{keyword}{class\ }ConfigurationCliBinding\ \{}
\DoxyCodeLine{00026\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00027\ \ \ \ \ ConfigurationCliBinding()\ :\ m\_setValueFlag(\textcolor{stringliteral}{"{}-\/set"{}},\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{keyword}{false},\ 255,\ []()\ \{\}),}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_configurationFlag(command(),\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{keyword}{true},\ 255,\ [\textcolor{keyword}{this}]()\ \{\ this-\/>callback();\ \})\ \{\}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keywordtype}{void}\ setup(\mbox{\hyperlink{classConfiguration}{Configuration}}*\ configuration,\ \mbox{\hyperlink{classParser}{Parser}}*\ parser,\ \mbox{\hyperlink{classDebugStream}{DebugStream}}*\ debugStream)\ \{}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ m\_data\ =\ configuration-\/>getConfigurable<ConfigurationID>();}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ parser-\/>\mbox{\hyperlink{classParser_abe4ff3e3ab2bbe35be3053c3510d37f2}{addFlagGroup}}(m\_configurationGeneratorGroup);}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ m\_debug\ =\ debugStream;}
\DoxyCodeLine{00034\ \ \ \ \ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordtype}{void}\ callback()\ \{}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_setValueFlag.isSet())\ \{}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ m\_data.set(m\_setValueFlag.getValueDerived());}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ printValue(name(),\ \textcolor{stringliteral}{"{}has\ been\ set\ to"{}},\ m\_data.get());}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ printValue(name(),\ \textcolor{stringliteral}{"{}is\ set\ to"{}},\ m\_data.get());}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00043\ \ \ \ \ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ name()\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structGetConfigurationType__s}{GetConfigurationType\_s<ConfigurationID>::name}};}
\DoxyCodeLine{00048\ \ \ \ \ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ command()\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structGetConfigurationType__s}{GetConfigurationType\_s<ConfigurationID>::command}};}
\DoxyCodeLine{00052\ \ \ \ \ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keyword}{using\ }config\_type\_t\ =\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{structGetConfigurationType__s}{GetConfigurationType\_s<ConfigurationID>::type}};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{typename}\ std::enable\_if<is\_configuration\_string<T>::value>::type}
\DoxyCodeLine{00058\ \ \ \ \ printValue(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ nameStr,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ msg,\ \textcolor{keyword}{const}\ T\&\ value)\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}\%s\ \%s:\ \%s"{}},\ nameStr,\ msg,\ value.str);}
\DoxyCodeLine{00060\ \ \ \ \ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{comment}{//\ Overload\ for\ floating\ point\ types}}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keyword}{typename}\ std::enable\_if<std::is\_floating\_point<T>::value>::type}
\DoxyCodeLine{00065\ \ \ \ \ printValue(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ nameStr,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ msg,\ \textcolor{keyword}{const}\ T\&\ value)\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}\%s\ \%s:\ \%.8f"{}},\ nameStr,\ msg,\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{//\ Overload\ for\ unsigned\ integral\ types}}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keyword}{typename}\ std::enable\_if<std::is\_integral<T>::value\ \&\&\ std::is\_unsigned<T>::value>::type}
\DoxyCodeLine{00072\ \ \ \ \ printValue(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ nameStr,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ msg,\ \textcolor{keyword}{const}\ T\&\ value)\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}\%s\ \%s:\ \%llu"{}},\ nameStr,\ msg,}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00075\ \ \ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{//\ Overload\ for\ signed\ integral\ types}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{typename}\ std::enable\_if<std::is\_integral<T>::value\ \&\&\ std::is\_signed<T>::value>::type}
\DoxyCodeLine{00080\ \ \ \ \ printValue(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ nameStr,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ msg,\ \textcolor{keyword}{const}\ T\&\ value)\ \{}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}\%s\ \%s:\ \%lld"{}},\ nameStr,\ msg,}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00083\ \ \ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ Fallback\ for\ unsupported\ types}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{comment}{//\ typename\ std::enable\_if<!std::is\_integral<T>::value\ \&\&\ !std::is\_floating\_point<T>::value>::type}}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keyword}{typename}\ std::enable\_if<!std::is\_integral<T>::value\ \&\&\ !std::is\_floating\_point<T>::value\ \&\&\ !\mbox{\hyperlink{structis__configuration__string}{is\_configuration\_string<T>::value}}>::type}
\DoxyCodeLine{00089\ \ \ \ \ printValue(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ nameStr,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ msg,\ \textcolor{keyword}{const}\ T\&)\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ m\_debug-\/>message(\textcolor{stringliteral}{"{}\%s\ \%s:\ (unsupported\ type)"{}},\ nameStr,\ msg);}
\DoxyCodeLine{00091\ \ \ \ \ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{classDebugStream}{DebugStream}}*\ m\_debug\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00094\ \ \ \ \ \mbox{\hyperlink{classConfigurationData}{ConfigurationData<config\_type\_t>}}\ m\_data\{\};}
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{comment}{//\ ArgumentFlag<config\_type\_t>\ m\_setValueFlag\{\};}}
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{classArgumentFlag}{ArgumentFlag<typename\ config\_flag\_type<config\_type\_t>::type}}>\ m\_setValueFlag\{\};}
\DoxyCodeLine{00097\ \ \ \ \ \mbox{\hyperlink{classSimpleFlag}{SimpleFlag}}\ m\_configurationFlag;}
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{classBaseFlag}{BaseFlag}}*\ m\_configurationGeneratorGroup[2]\ =\ \{\&m\_configurationFlag,\ \&m\_setValueFlag\};}
\DoxyCodeLine{00099\ \};}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \textcolor{keyword}{template}\ <std::size\_t...\ Is>}
\DoxyCodeLine{00102\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structindex__sequence}{index\_sequence}}\ \{\};}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \textcolor{keyword}{template}\ <std::size\_t\ N,\ std::size\_t...\ Is>}
\DoxyCodeLine{00105\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structmake__index__sequence}{make\_index\_sequence}}\ :\ \mbox{\hyperlink{structmake__index__sequence}{make\_index\_sequence}}<N\ -\/\ 1,\ N\ -\/\ 1,\ Is...>\ \{\};}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \textcolor{keyword}{template}\ <std::size\_t...\ Is>}
\DoxyCodeLine{00108\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structmake__index__sequence}{make\_index\_sequence}}<0,\ Is...>\ :\ \mbox{\hyperlink{structindex__sequence}{index\_sequence}}<Is...>\ \{\};}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \textcolor{comment}{//\ Variadic\ wrapper}}
\DoxyCodeLine{00112\ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{unsigned}...\ Configs>}
\DoxyCodeLine{00113\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structConfigurationCliBindings}{ConfigurationCliBindings}}\ \{}
\DoxyCodeLine{00114\ \ \ \ \ std::tuple<ConfigurationCliBinding<Configs>...>\ bindings;}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordtype}{void}\ setupAll(\mbox{\hyperlink{classConfiguration}{Configuration}}*\ configuration,\ \mbox{\hyperlink{classParser}{Parser}}*\ parser,\ \mbox{\hyperlink{classDebugStream}{DebugStream}}*\ debugStream)\ \{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ setupAllImpl(\mbox{\hyperlink{structmake__index__sequence}{make\_index\_sequence}}<\textcolor{keyword}{sizeof}...(Configs)>(),\ configuration,\ parser,\ debugStream);}
\DoxyCodeLine{00118\ \ \ \ \ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keyword}{template}\ <std::size\_t...\ Is>}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordtype}{void}\ setupAllImpl(\mbox{\hyperlink{structindex__sequence}{index\_sequence<Is...>}},\ \mbox{\hyperlink{classConfiguration}{Configuration}}*\ configuration,\ \mbox{\hyperlink{classParser}{Parser}}*\ parser,\ \mbox{\hyperlink{classDebugStream}{DebugStream}}*\ debugStream)\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Expand\ parameter\ pack\ using\ initializer\ list\ trick}}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ dummy[]\ =\ \{(std::get<Is>(bindings).setup(configuration,\ parser,\ debugStream),\ 0)...\};}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ (void)dummy;\ \textcolor{comment}{//\ suppress\ unused\ warning}}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ \};}

\end{DoxyCode}
