\doxysection{Configuration\+Registry.\+h}
\hypertarget{ConfigurationRegistry_8h_source}{}\label{ConfigurationRegistry_8h_source}\index{nuli-\/avionics-\/flight-\/software/platformio\_nuli\_avionics\_flight\_software/src/ConfigurationRegistry.h@{nuli-\/avionics-\/flight-\/software/platformio\_nuli\_avionics\_flight\_software/src/ConfigurationRegistry.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ PLATFORMIO\_NULI\_AVIONICS\_FLIGHT\_SOFTWARE\_CONFIGURATIONREGISTRY\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ PLATFORMIO\_NULI\_AVIONICS\_FLIGHT\_SOFTWARE\_CONFIGURATIONREGISTRY\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{Avionics_8h}{Avionics.h}}"{}}}
\DoxyCodeLine{00005\ \textcolor{comment}{}}
\DoxyCodeLine{00006\ \textcolor{comment}{/**}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ Register\ all\ config\ variables}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *\ This\ syntax\ enables\ the\ compile\ time\ type\ checking\ and\ fully\ safe\ configuration\ system}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *\ ALL\ variables\ used\ across\ all\ boards/builds\ must\ be\ declared\ here.\ Any\ given\ board/build}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *\ will\ only\ use\ a\ subset\ of\ these\ variable}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *\ To\ create\ a\ new\ configuration\ variable,\ use\ the\ following\ macro:}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *\ \ \ \ \ \ DEFINE\_CONFIGURATION\_VARIABLE(NAME,\ type\_t,\ defaultValue,\ conditionForValueToBeValid)}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ How\ to\ use\ conditionForValueToBeValid}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ \ \ \ \ \ This\ will\ basically\ be\ inserted\ into\ a\ function:\ isValid(const\ type\_t\&\ value)\ \{\ return\ conditionForValueToBeValid;\ \};}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ *\ \ \ \ \ \ So\ you\ can\ write\ 'true'\ if\ you\ want\ to\ disable\ valid\ checks.}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *\ \ \ \ \ \ Valid\ checks\ will\ not\ invalidate\ the\ entire\ configuration,\ just\ the\ single\ varable}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *\ \ \ \ \ \ A\ common\ way\ to\ write\ this\ would\ be\ 'value\ >=\ 0\ \&\&\ value\ <=\ 10'}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ \ \ \ \ \ If\ type\_t\ is\ a\ struct:\ you\ can\ access\ it\ as\ a\ struct:\ 'value.member\ >=\ 0\ \&\&\ value.member\ <=\ 10'}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ *\ To\ construct\ a\ new\ configuration\ you\ need\ to\ pass\ it\ all\ configuration\ variables\ that}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ *\ ANY\ part\ of\ your\ code\ uses.\ You\ do\ this\ by\ passing\ an\ 2-\/dimensional\ array\ of\ IDs.}}
\DoxyCodeLine{00023\ \textcolor{comment}{\ *\ It's\ ok\ to\ have\ duplicates\ in\ this\ list:\ it\ will\ filter\ them\ out.\ You\ will\ allways\ need}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ *\ Configuration::REQUIRED\_CONFIGS\ in\ the\ constructor\ for\ the\ Configuration\ to\ work\ at\ all.}}
\DoxyCodeLine{00025\ \textcolor{comment}{\ *\ \ \ \ \ \ ConfigurationID\_t\ requiredConfigs[]\ =\ \{DROGUE\_DELAY\_c,\ MAIN\_ELEVATION\_c\};}}
\DoxyCodeLine{00026\ \textcolor{comment}{\ *\ \ \ \ \ \ Configuration\ configuration(\{requiredConfigs,\ Configuration::REQUIRED\_CONFIGS,\ FlightStateDeterminer::REQUIRED\_CONFIGS,\ StateEstimator1D::REQUIRED\_CONFIGS\});}}
\DoxyCodeLine{00027\ \textcolor{comment}{\ *\ \ \ \ \ \ configuration.setup(\&hardware,\ framID);\ \ \ \ \ //\ framID\ is\ the\ Index\ of\ the\ FRAM\ in\ the\ hardware\ list}}
\DoxyCodeLine{00028\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00029\ \textcolor{comment}{\ *\ Interacting\ with\ an\ individual\ configuration\ variable:}}
\DoxyCodeLine{00030\ \textcolor{comment}{\ *\ \ \ \ \ \ ConfigurationData<int32\_t>\ flightState\ =\ configuration.getConfigurable<FLIGHT\_STATE\_c>();}}
\DoxyCodeLine{00031\ \textcolor{comment}{\ *\ \ \ \ \ \ int32\_t\ flightState\ =\ flightState.get();}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ *\ \ \ \ \ \ flightState.set(ASCENT);}}
\DoxyCodeLine{00033\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00034\ \textcolor{comment}{\ *\ Call\ this\ every\ loop,\ it\ checks\ for\ any\ changed\ configuration\ variables\ and\ writes\ the\ changes\ to\ FRAM}}
\DoxyCodeLine{00035\ \textcolor{comment}{\ *\ \ \ \ \ \ configuration.pushUpdatesToMemory();}}
\DoxyCodeLine{00036\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00037\ \textcolor{comment}{\ *\ System\ limitations:}}
\DoxyCodeLine{00038\ \textcolor{comment}{\ *\ \ \ \ \ \ -\/\ There\ is\ a\ maximum\ number\ of\ configuration\ variables\ allowed\ per\ build,\ and\ max\ total\ bytes\ of\ data.}}
\DoxyCodeLine{00039\ \textcolor{comment}{\ *\ \ \ \ \ \ \ \ This\ is\ defined\ in\ Avionics.h\ with\ MAX\_CONFIGURATION\_NUM\ and\ MAX\_CONFIGURATION\_LENGTH}}
\DoxyCodeLine{00040\ \textcolor{comment}{\ *\ \ \ \ \ \ -\/\ Currently\ the\ system\ doesn't\ support\ any\ runtime\ variability\ of\ getConfigurable<>().\ Use\ dependency}}
\DoxyCodeLine{00041\ \textcolor{comment}{\ *\ \ \ \ \ \ \ \ injection\ if\ a\ class\ needs\ to\ be\ able\ to\ reference\ different\ configuration\ variables\ in\ different\ builds}}
\DoxyCodeLine{00042\ \textcolor{comment}{\ *\ \ \ \ \ \ -\/\ There\ is\ a\ maximum\ number\ of\ configuration\ variables\ than\ can\ possibly\ be\ defined,\ due\ to\ template\ recursion}}
\DoxyCodeLine{00043\ \textcolor{comment}{\ *\ \ \ \ \ \ \ \ limits.\ Probably\ around\ 1000.}}
\DoxyCodeLine{00044\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{comment}{//\ clang-\/format\ off}}
\DoxyCodeLine{00047\ DEFINE\_CONFIGURATION\_VARIABLE(BOARD\_NAME,\ \mbox{\hyperlink{structConfigurationString}{ConfigurationString<100>}},\ \textcolor{stringliteral}{"{}UNKNOWN\_BOARD"{}},\ strlen(value.str)\ <\ 100);}
\DoxyCodeLine{00048\ DEFINE\_CONFIGURATION\_VARIABLE(FLIGHT\_STATE,\ int32\_t,\ UNKNOWN\_FLIGHT\_STATE,\ value\ >=\ PRE\_FLIGHT\ \&\&\ value\ <=\ UNKNOWN\_FLIGHT\_STATE)}
\DoxyCodeLine{00049\ DEFINE\_CONFIGURATION\_VARIABLE(GROUND\_ELEVATION,\ \textcolor{keywordtype}{float},\ 0.0,\ value\ >=\ -\/500.0\ \&\&\ value\ <=\ 9000.0)}
\DoxyCodeLine{00050\ DEFINE\_CONFIGURATION\_VARIABLE(GROUND\_TEMPERATURE,\ \textcolor{keywordtype}{float},\ \mbox{\hyperlink{classConstants}{Constants}}::STANDARD\_TEMPERATURE\_K,\ value\ >=\ 180.0\ \&\&\ value\ <=\ 350.0)}
\DoxyCodeLine{00051\ DEFINE\_CONFIGURATION\_VARIABLE(BOARD\_ORIENTATION,\ int32\_t,\ ERROR\_AXIS\_DIRECTION,\ value\ >=\ ERROR\_AXIS\_DIRECTION\ \&\&\ value\ <=\ NEG\_Z)}
\DoxyCodeLine{00052\ DEFINE\_CONFIGURATION\_VARIABLE(LAUNCH\_ANGLE,\ \mbox{\hyperlink{structQuaternion__s}{Quaternion\_s}},\ \mbox{\hyperlink{structQuaternion__s}{Quaternion\_s}}(\{0,0,0,1\}),\ \textcolor{keyword}{true})}
\DoxyCodeLine{00053\ DEFINE\_CONFIGURATION\_VARIABLE(GYROSCOPE\_BIAS,\ \mbox{\hyperlink{structGyroscopeBias__s}{GyroscopeBias\_s}},\ \mbox{\hyperlink{structGyroscopeBias__s}{GyroscopeBias\_s}}(),\ \textcolor{keyword}{true})}
\DoxyCodeLine{00054\ DEFINE\_CONFIGURATION\_VARIABLE(PYRO\_FIRE\_DURATION,\ uint32\_t,\ 1000,\ value\ >=\ 10\ \&\&\ value\ <=\ 60\ *\ \mbox{\hyperlink{classUnits}{Units}}::S\_TO\_MS)}
\DoxyCodeLine{00055\ DEFINE\_CONFIGURATION\_VARIABLE(MAIN\_ELEVATION,\ \textcolor{keywordtype}{float},\ 200.0,\ value\ >\ 50)}
\DoxyCodeLine{00056\ DEFINE\_CONFIGURATION\_VARIABLE(DROGUE\_DELAY,\ uint32\_t,\ 1000,\ value\ <\ 60\ *\ \mbox{\hyperlink{classUnits}{Units}}::S\_TO\_MS)}
\DoxyCodeLine{00057\ DEFINE\_CONFIGURATION\_VARIABLE(BATTERY\_VOLTAGE\_SENSOR\_SCALE\_FACTOR,\ \textcolor{keywordtype}{float},\ 1.0,\ true)}
\DoxyCodeLine{00058\ DEFINE\_CONFIGURATION\_VARIABLE(RADIO\_FREQUENCY,\ \textcolor{keywordtype}{float},\ 915.0,\ value\ >\ 0)}
\DoxyCodeLine{00059\ \textcolor{comment}{//\ clang-\/format\ on}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//PLATFORMIO\_NULI\_AVIONICS\_FLIGHT\_SOFTWARE\_CONFIGURATIONREGISTRY\_H}}

\end{DoxyCode}
