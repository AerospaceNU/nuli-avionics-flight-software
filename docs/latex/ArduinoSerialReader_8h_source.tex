\doxysection{Arduino\+Serial\+Reader.\+h}
\hypertarget{ArduinoSerialReader_8h_source}{}\label{ArduinoSerialReader_8h_source}\index{nuli-\/avionics-\/flight-\/software/platformio\_nuli\_avionics\_flight\_software/src/drivers/arduino/ArduinoSerialReader.h@{nuli-\/avionics-\/flight-\/software/platformio\_nuli\_avionics\_flight\_software/src/drivers/arduino/ArduinoSerialReader.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ ARDUINOSERIALREADER\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ ARDUINOSERIALREADER\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <Arduino.h>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{Avionics_8h}{Avionics.h}}"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}core/generic\_hardware/LineReader.h"{}}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{/**}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *\ @class\ ArduinoSerialReader}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *\ @brief\ Reads\ newline-\/terminated\ text\ lines\ from\ the\ Arduino\ serial\ interface\ into\ a\ fixed-\/size\ buffer.}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *\ @details\ \ This\ class\ provides\ a\ simple\ line\ reader\ implementation\ that\ reads\ characters\ from\ the\ global}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *\ Arduino\ Serial\ interface.\ Characters\ are\ stored\ in\ an\ internal\ buffer\ up\ to\ a\ fixed\ capacity\ N.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *\ When\ a\ newline\ character\ ('\(\backslash\)n')\ is\ received,\ the\ buffer\ is\ null-\/terminated\ and\ the\ function\ returns\ true.}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ Optionally,\ received\ characters\ can\ be\ echoed\ back\ to\ the\ serial\ output\ as\ they\ are\ read.}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ @tparam\ N\ The\ maximum\ size\ of\ the\ line\ buffer,\ including\ the\ null\ terminator.}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00017\ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{unsigned}\ N>}
\DoxyCodeLine{00018\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classArduinoSerialReader_ad37564fed2b1dafd6d0b2a4bf9d058a3}{ArduinoSerialReader}}\ final\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classLineReader}{LineReader}}\ \{}
\DoxyCodeLine{00019\ \textcolor{keyword}{public}:\textcolor{comment}{}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Constructs\ a\ new\ ArduinoSerialReader.}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ \ \ \ \ *\ @details\ \ Initializes\ the\ internal\ buffer\ and\ configures\ whether\ to\ echo\ received\ characters.}}
\DoxyCodeLine{00023\ \textcolor{comment}{\ \ \ \ \ *\ @param\ echo\ If\ each\ received\ character\ will\ be\ echoed\ back\ to\ the\ serial\ output.}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classArduinoSerialReader_ad37564fed2b1dafd6d0b2a4bf9d058a3}{ArduinoSerialReader}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ echo\ =\ \textcolor{keyword}{false})\ :\ m\_echo(echo)\ \{\}}
\DoxyCodeLine{00026\ \textcolor{comment}{}}
\DoxyCodeLine{00027\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{00028\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Reads\ characters\ from\ the\ serial\ buffer\ until\ a\ full\ line\ is\ received.}}
\DoxyCodeLine{00029\ \textcolor{comment}{\ \ \ \ \ *\ @details\ This\ function\ reads\ all\ available\ characters\ from\ Serial.\ Characters\ are\ appended\ to\ an\ internal}}
\DoxyCodeLine{00030\ \textcolor{comment}{\ \ \ \ \ *\ buffer\ until\ either\ the\ buffer\ limit\ N\ -\/\ \`{}\ is\ reached\ or\ a\ newline\ character\ ('\(\backslash\)n')\ is\ received.}}
\DoxyCodeLine{00031\ \textcolor{comment}{\ \ \ \ \ *\ When\ a\ newline\ is\ encountered,\ the\ buffer\ is\ null-\/terminated,\ the\ read\ index\ is\ reset,}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ \ \ \ \ *\ and\ the\ function\ returns\ \`{}true`\ to\ indicate\ that\ a\ full\ line\ is\ ready.}}
\DoxyCodeLine{00033\ \textcolor{comment}{\ \ \ \ \ *\ If\ echo\ mode\ is\ enabled,\ each\ received\ character\ is\ also\ immediately\ sent\ back\ via\ Serial.print()}}
\DoxyCodeLine{00034\ \textcolor{comment}{\ \ \ \ \ *\ @return\ if\ a\ complete\ line\ ending\ in\ \`{}'\(\backslash\)n'`\ was\ read\ and\ is\ ready\ to\ be\ retrieved\ with\ getLine()}}
\DoxyCodeLine{00035\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classArduinoSerialReader_a8827a9db81e0b42ac34c0a11f21109e1}{readLine}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (Serial.available()\ >\ 0)\ \{}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ c\ =\ Serial.read();}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_serialReadIndex\ <\ N\ -\/\ 1)\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_serialRead[m\_serialReadIndex++]\ =\ c;}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_echo)\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(c);}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (c\ ==\ \textcolor{charliteral}{'\(\backslash\)n'})\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_serialRead[m\_serialReadIndex]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_serialReadIndex\ =\ 0;}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00052\ \ \ \ \ \}}
\DoxyCodeLine{00053\ \textcolor{comment}{}}
\DoxyCodeLine{00054\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{00055\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Returns\ a\ pointer\ to\ the\ internal\ line\ buffer.}}
\DoxyCodeLine{00056\ \textcolor{comment}{\ \ \ \ \ *\ @details\ The\ returned\ buffer\ contains\ the\ most\ recently\ read\ line,\ null-\/terminated.}}
\DoxyCodeLine{00057\ \textcolor{comment}{\ \ \ \ \ *\ The\ buffer\ is\ overwritten\ on\ the\ next\ successful\ call\ to\ \`{}readLine()`.}}
\DoxyCodeLine{00058\ \textcolor{comment}{\ \ \ \ \ *\ @return\ A\ pointer\ to\ the\ internal\ character\ buffer\ containing\ the\ last\ line.}}
\DoxyCodeLine{00059\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classArduinoSerialReader_a76221ac13b40404b901005feb6da4c20}{getLine}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_serialRead;}
\DoxyCodeLine{00062\ \ \ \ \ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_echo\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{///<\ Whether\ to\ echo\ received\ characters\ back\ to\ the\ serial\ output.}}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordtype}{char}\ m\_serialRead[N]\ =\ \textcolor{stringliteral}{"{}"{}};\ \textcolor{comment}{///<\ Internal\ buffer\ used\ to\ store\ the\ current\ line\ being\ read.}}
\DoxyCodeLine{00067\ \ \ \ \ uint32\_t\ m\_serialReadIndex\ =\ 0;\ \textcolor{comment}{///<\ Current\ write\ index\ within\ the\ line\ buffer.}}
\DoxyCodeLine{00068\ \};}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//ARDUINOSERIALREADER\_H}}

\end{DoxyCode}
