\doxysection{Configuration.\+h}
\hypertarget{Configuration_8h_source}{}\label{Configuration_8h_source}\index{nuli-\/avionics-\/flight-\/software/platformio\_nuli\_avionics\_flight\_software/src/core/Configuration.h@{nuli-\/avionics-\/flight-\/software/platformio\_nuli\_avionics\_flight\_software/src/core/Configuration.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ PLATFORMIO\_NULI\_AVIONICS\_FLIGHT\_SOFTWARE\_CONFIGURATION\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ PLATFORMIO\_NULI\_AVIONICS\_FLIGHT\_SOFTWARE\_CONFIGURATION\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{Avionics_8h}{Avionics.h}}"{}}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}ConfigurationRegistry.h"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}HardwareAbstraction.h"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}generic\_hardware/FramMemory.h"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}generic\_hardware/DebugStream.h"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <Arduino.h>}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structBaseConfigurationData__s}{BaseConfigurationData\_s}}\ \{}
\DoxyCodeLine{00013\ \ \ \ \ uint8\_t*\ data\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00014\ \ \ \ \ uint16\_t\ size\ =\ 0;}
\DoxyCodeLine{00015\ \ \ \ \ ConfigurationID\_e\ name\ =\ ConfigurationID\_e::NONE;}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_isUpdated\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00017\ \};}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00020\ \textcolor{keyword}{struct\ }ConfigurationData\ \{}
\DoxyCodeLine{00021\ \ \ \ \ \mbox{\hyperlink{structBaseConfigurationData__s}{BaseConfigurationData\_s}}*\ base\ =\ \textcolor{keyword}{nullptr};\ \textcolor{comment}{//\ pointer\ to\ the\ underlying\ data}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \ \ \ ConfigurationData()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{comment}{//\ Constructor\ from\ BaseConfigurationData\_s*}}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keyword}{explicit}\ ConfigurationData(\mbox{\hyperlink{structBaseConfigurationData__s}{BaseConfigurationData\_s}}*\ b)\ :\ base(b)\ \{\}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \ \ T\ get()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!base\ ||\ !base-\/>data)\ \textcolor{keywordflow}{return}\ T\{\};\ \textcolor{comment}{//\ default-\/constructed\ T}}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const\ }T*\textcolor{keyword}{>}(base-\/>data);}
\DoxyCodeLine{00031\ \ \ \ \ \}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keywordtype}{void}\ set(\textcolor{keyword}{const}\ T\&\ newVal)\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!base\ ||\ !base-\/>data)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ *\textcolor{keyword}{reinterpret\_cast<}T*\textcolor{keyword}{>}(base-\/>data)\ =\ newVal;}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ base-\/>m\_isUpdated\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00037\ \ \ \ \ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keywordtype}{bool}\ isValid()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ base\ !=\ \textcolor{keyword}{nullptr};\ \}}
\DoxyCodeLine{00040\ \};}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{keyword}{class\ }Configuration\ \{}
\DoxyCodeLine{00043\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{static}\ ConfigurationID\_e\ REQUIRED\_CONFIGS[]\ =\ \{CONFIGURATION\_VERSION,\ CONFIGURATION\_VERSION\_HASH,\ CONFIGURATION\_CRC\};}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{unsigned}\ N,\ \textcolor{keywordtype}{unsigned}\ M>}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keyword}{explicit}\ Configuration(\textcolor{keyword}{const}\ \mbox{\hyperlink{structConfigurationIDSet__s}{ConfigurationIDSet\_s}}\ (\&allConfigs)[N],\ uint8\_t\ (\&buffer)[M]):\ m\_dataBuffer(buffer),\ m\_dataBufferMaxLength(M)\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ construct(allConfigs,\ N);}
\DoxyCodeLine{00049\ \ \ \ \ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{unsigned}\ N>}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keyword}{explicit}\ Configuration(\textcolor{keyword}{const}\ \mbox{\hyperlink{structConfigurationIDSet__s}{ConfigurationIDSet\_s}}\ (\&allConfigs)[N]):\ m\_dataBuffer(m\_buffer),\ m\_dataBufferMaxLength(MAX\_CONFIGURATION\_LENGTH)\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ construct(allConfigs,\ N);}
\DoxyCodeLine{00054\ \ \ \ \ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{void}\ setup(\mbox{\hyperlink{classHardwareAbstraction}{HardwareAbstraction}}*\ hardware,\ uint8\_t\ \textcolor{keywordtype}{id});}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{unsigned}\ N>}
\DoxyCodeLine{00059\ \ \ \ \ \mbox{\hyperlink{structConfigurationData}{ConfigurationData<typename\ GetConfigurationType\_s<N>::type}}>\ getConfigurable()\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }T\ =\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{structGetConfigurationType__s}{GetConfigurationType\_s<N>::type}};}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ConfigurationID\_e\ \textcolor{keywordtype}{id}\ =\ ConfigurationID\_e(N);}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structBaseConfigurationData__s}{BaseConfigurationData\_s}}*\ base\ =\ configExists(\textcolor{keywordtype}{id})\ ?\ getBaseConfigurationData(\textcolor{keywordtype}{id})\ :\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structConfigurationData}{ConfigurationData<T>}}(base);}
\DoxyCodeLine{00064\ \ \ \ \ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{comment}{//\ template\ <typename\ T>}}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{comment}{//\ ConfigurationData<T>\ getConfigurableByName(const\ char*\ str)\ \{}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ const\ ConfigurationID\_e\ id\ =\ getConfigurationID(str);}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ BaseConfigurationData\_s*\ base\ =\ (id\ !=\ NONE\ \&\&\ configExists(id))\ ?\ getBaseConfigurationData(id)\ :\ nullptr;}}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ if\ (base\ \&\&\ base-\/>data\ \&\&\ base-\/>size\ ==\ sizeof(T))\ \{}}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ return\ ConfigurationData<T>(base);}}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \}}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ //\ fail-\/safe:\ return\ invalid\ ConfigurationData}}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ return\ ConfigurationData<T>(nullptr);}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ template\ <typename\ T>}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ ConfigurationData<T>\ getConfigurableByID(const\ ConfigurationID\_e\ id)\ \{}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ BaseConfigurationData\_s*\ base\ =\ (id\ !=\ NONE\ \&\&\ configExists(id))\ ?\ getBaseConfigurationData(id)\ :\ nullptr;}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ if\ (base\ \&\&\ base-\/>data\ \&\&\ base-\/>size\ ==\ sizeof(T))\ \{}}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ return\ ConfigurationData<T>(base);}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \}}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ //\ fail-\/safe}}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ return\ ConfigurationData<T>(nullptr);}}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordtype}{void}\ pushUpdatesToMemory();}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00094\ \ \ \ \ \mbox{\hyperlink{structBaseConfigurationData__s}{BaseConfigurationData\_s}}*\ getBaseConfigurationData(ConfigurationID\_e\ name)\ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ int32\_t\ left\ =\ 0;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ int32\_t\ right\ =\ (int32\_t)m\_numConfigurations\ -\/\ 1;}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (left\ <=\ right)\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ mid\ =\ left\ +\ (right\ -\/\ left)\ /\ 2;}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ midName\ =\ m\_configurations[mid].name;}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (midName\ ==\ name)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&m\_configurations[mid];}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (midName\ <\ name)\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ left\ =\ mid\ +\ 1;}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ right\ =\ mid\ -\/\ 1;}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00111\ \ \ \ \ \}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordtype}{void}\ construct(\textcolor{keyword}{const}\ \mbox{\hyperlink{structConfigurationIDSet__s}{ConfigurationIDSet\_s}}*\ allConfigs,\ uint16\_t\ allConfigsLength);}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{void}\ readConfigFromMemory()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordtype}{bool}\ configExists(ConfigurationID\_e\ name)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordtype}{void}\ sortConfigs();}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keywordtype}{void}\ assignMemory();}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ outOfMemoryError();}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ uint8\_t*\ m\_dataBuffer;}
\DoxyCodeLine{00126\ \ \ \ \ uint32\_t\ m\_dataBufferIndex\ =\ 0;}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ m\_dataBufferMaxLength\ =\ 0;}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ uint8\_t\ m\_buffer[MAX\_CONFIGURATION\_LENGTH]\ =\ \{\};}
\DoxyCodeLine{00130\ \ \ \ \ \mbox{\hyperlink{structBaseConfigurationData__s}{BaseConfigurationData\_s}}\ m\_configurations[MAX\_CONFIGURATION\_NUM]\ =\ \{\};}
\DoxyCodeLine{00131\ \ \ \ \ uint32\_t\ m\_numConfigurations\ =\ 0;}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \mbox{\hyperlink{classHardwareAbstraction}{HardwareAbstraction}}*\ m\_hardware\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00134\ \ \ \ \ \mbox{\hyperlink{classFramMemory}{FramMemory}}*\ m\_memory\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00135\ \ \ \ \ \mbox{\hyperlink{classDebugStream}{DebugStream}}*\ m\_debug\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00136\ \};}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//PLATFORMIO\_NULI\_AVIONICS\_FLIGHT\_SOFTWARE\_CONFIGURATION\_H}}

\end{DoxyCode}
